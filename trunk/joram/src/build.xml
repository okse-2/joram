<?xml version="1.0" standalone="yes"?>

<project default="ship.joram" basedir=".">
  <!-- Initializes properties -->
  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
    <!-- Initialize the environment properties, use ${env.name} -->
    <property environment="env"/>
  
    <!-- Get the user defined properties from file -->
    <property file="build.properties"/>

    <!-- Initialize the directory structure properties -->
    <property name="src.dir" location="."/>
    <property name="obj.dir" location="../classes"/>
    <property name="lib.dir" location="../lib"/>
    <property name="build.dir" location="../build"/>
    <property name="ship.dir" location="../ship"/>
    <property name="doc.dir" location="../javadoc"/>

    <!-- Base classpath needed for execution -->
    <path id="base.class.path">
      <pathelement path="${java.class.path}/"/>
      <fileset dir="${lib.dir}">
        <include name="jakarta-regexp-1.2.jar"/>
        <include name="JCup.jar"/>
        <include name="jms.jar"/>
        <include name="jndi.jar"/>
        <include name="jta.jar"/>
        <include name="log4j.jar"/>
        <include name="owlogapi.jar"/>
        <include name="owlogwrpl4j.jar"/>
        <include name="xerces.jar"/>
      </fileset>
    </path>

    <!-- Project classpath needed for compilation -->
    <path id="project.class.path">
      <path refid="base.class.path"/>
      <pathelement path="${obj.dir}"/>
      <pathelement path="${additional.path}"/>
    </path>
  </target>

  <!-- Clean all generated files -->
  <target name="clean" depends="init"
      description="--> Clean all generated files">
    <delete dir="${obj.dir}"/>
    <delete dir="${build.dir}"/>
    <delete dir="${ship.dir}"/>
    <delete dir="${doc.dir}"/>
    <!-- Deletes bad files in src directory tree -->
  </target>

  <!-- Prepare compilation phase -->
  <target name="prepare" depends="init">
    <!-- Create the directory structure -->
    <mkdir dir="${obj.dir}"/>
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${doc.dir}"/>
  </target>

  <target name="compile" depends="prepare"
      description="--> Compile JORAM">
    <javac srcdir="${src.dir}:${obj.dir}"
           destdir="${obj.dir}"
           debug="true"
           deprecation="${deprecation}"
           optimize="false"
           nowarn="${nowarn}"
           verbose="${verbose}">

      <classpath refid="project.class.path"/>

      <include name="**/*.java"/>

      <!-- Excludes tests and CVS directories -->
      <exclude name="fr/dyade/aaa/**/CVS/**/*.java"/>
    </javac>
  </target>

  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     - Joram specific build target
     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
  <target name="build.joram" depends="init,compile"
      description="--> Build JORAM jar files">
    <!-- Build mom jar file -->
    <jar jarfile="${build.dir}/mom.jar">
      <fileset dir="${obj.dir}">
        <include name="fr/dyade/aaa/util/*.class"/>
        <include name="fr/dyade/aaa/agent/*.class"/>
        <include name="fr/dyade/aaa/ip/*.class"/>
        <include name="fr/dyade/aaa/scbean/*.class"/>
        <include name="fr/dyade/aaa/task/*.class"/>
        <include name="fr/dyade/aaa/ns/*.class"/>
        <include name="fr/dyade/aaa/jndi/*.class"/>
        <include name="fr/dyade/aaa/mom/*.class"/>
        <include name="fr/dyade/aaa/mom/comm/*.class"/>
        <include name="fr/dyade/aaa/mom/dest/*.class"/>
        <include name="fr/dyade/aaa/mom/excepts/*.class"/>
        <include name="fr/dyade/aaa/mom/jms/*.class"/>
        <include name="fr/dyade/aaa/mom/messages/*.class"/>
        <include name="fr/dyade/aaa/mom/proxies/*.class"/>
        <include name="fr/dyade/aaa/mom/selectors/*.class"/>
        <exclude name="fr/dyade/aaa/**/tests/**/*.class"/>
      </fileset>
    </jar>
    <jar jarfile="${build.dir}/joram.jar">
      <fileset dir="${obj.dir}">
        <include name="fr/dyade/aaa/mom/excepts/*.class"/>
        <include name="fr/dyade/aaa/mom/jms/*.class"/>
        <include name="fr/dyade/aaa/mom/messages/*.class"/>
        <include name="fr/dyade/aaa/mom/selectors/*.class"/>
        <include name="fr/dyade/aaa/joram/*.class"/>
        <include name="fr/dyade/aaa/joram/admin/*.class"/>
        <exclude name="fr/dyade/aaa/**/tests/**/*.class"/>
      </fileset>
    </jar>
  </target>

  <!-- Specific Joram shipment -->
  <target name="ship.joram" depends="build.joram"
      description="--> Create a shipment of JORAM">
    <mkdir dir="${ship.dir}"/>
    <!-- lib directory -->
    <mkdir dir="${ship.dir}/lib"/>
    <copy file="${build.dir}/joram.jar" todir="${ship.dir}/lib"/>
    <copy file="${build.dir}/mom.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/jms.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/jta.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/log4j.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/owlogapi.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/owlogwrpl4j.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/jakarta-regexp-1.2.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/JCup.jar" todir="${ship.dir}/lib"/>
    <copy file="${lib.dir}/xerces.jar" todir="${ship.dir}/lib"/>
    <!-- run directory -->
    <mkdir dir="${ship.dir}/run"/>
    <copy file="${src.dir}/fr/dyade/aaa/agent/a3config.dtd"
          todir="${ship.dir}/run"/>
    <chmod dir="${ship.dir}/run" perm="755"/>
    <!-- licences directory -->
    <mkdir dir="${ship.dir}/licences"/>
    <copy todir="${ship.dir}/licences" flatten="yes">
      <fileset dir="${src.dir}">
        <include name="licenses/XERCES_LICENSE.TXT"/>
        <include name="licenses/JAKARTA-REGEXP_LICENSE.TXT"/>
        <include name="licenses/JORAM_LICENSE.TXT"/>
        <include name="licenses/Opl_1_0.TXT"/>
        <include name="licenses/EXHIBIT_A.TXT"/>
      </fileset>
    </copy>
  </target>
 
  <target name="javadoc" depends="prepare"
      description="--> Generate Javadoc">
  <!-- Path needed to create the javadoc  -->
  <path id="doc.class.path">
    <fileset dir="${lib.dir}">
      <include name="jms.jar"/>
      <include name="log4j.jar"/>
      <include name="owlogapi.jar"/>
      <include name="owlogwrpl4j.jar"/>
      <include name="xerces.jar"/>
      <include name="jndi.jar"/>
    </fileset>
  </path>
  
  <javadoc sourcepath="${src.dir}"
    destdir="${doc.dir}"
    classpathref="doc.class.path"
    overview="overview.html"
    access="${doc.access}"
    version="${doc.version}"
    author="${doc.author}"
    windowtitle="${doc.name} API"
             doctitle="${doc.name}"
    bottom="Copyright &#xA9; 2001 Scalagent - All rights reserved">
    <package name="fr.dyade.aaa.util"/>
    <package name="fr.dyade.aaa.agent"/>
    <package name="fr.dyade.aaa.ip"/>
    <package name="fr.dyade.aaa.task"/>
    <package name="fr.dyade.aaa.ns"/>
    <package name="fr.dyade.aaa.jndi"/> 
    <package name="fr.dyade.aaa.mom"/>
    <package name="fr.dyade.aaa.mom.comm"/>
    <package name="fr.dyade.aaa.mom.dest"/>
    <package name="fr.dyade.aaa.mom.excepts"/>
    <package name="fr.dyade.aaa.mom.jms"/>
    <package name="fr.dyade.aaa.mom.messages"/>
    <package name="fr.dyade.aaa.mom.proxies"/>
    <package name="fr.dyade.aaa.mom.selectors"/>
    <package name="fr.dyade.aaa.joram"/>
    <package name="fr.dyade.aaa.joram.admin"/>
  </javadoc>
  </target>
</project>
<?xml version="1.0"?>

<!DOCTYPE project [
    <!ENTITY common SYSTEM "file:../../../common.xml">
]>

<project default="tests.odis" basedir="../..">

  <!--
    - ODIS Tests
    -->
  <target name="tests.odis" depends="test1.odis" />

  <target name="init.src">
    <!-- Tests specific sources set -->
    <patternset id="specific">
      <include name="joram/studycase/odis/*.java"/>
    </patternset>
  </target>

  <!-- Include generic part -->
  &common;

  <target name="init.test.odis" depends="init">
    <delete dir="${test.dir}"/>
    <mkdir dir="${test.dir}"/>
    <copy file="${a3conf}" tofile="${test.dir}/a3servers.xml"/>
    <replace file="${test.dir}/a3servers.xml"
             token="@engine@" value="${engine}"/>
    <replace file="${test.dir}/a3servers.xml"
             token="@transaction@" value="${transaction}"/>
    <replace file="${test.dir}/a3servers.xml"
             token="@network@" value="${network}"/>
    <replace file="${test.dir}/a3servers.xml"
             token="@multiCnxSync@" value="${multiCnx}"/>

    <copy file="a3debug.cfg" tofile="${test.dir}/a3debug.cfg"/>
    <copy file="${jndiconf}" tofile="${test.dir}/jndi.properties"/>
  </target>

  <target name="test.run" depends="init.test.odis">
    <java classname="${className}"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line="-Dframework.TestCase.TestId=0 -Dframework.TestCase.OutFile=${report.file} ${jvmargs}"/>
      <arg line="${arg}"/>
    </java>
  </target>

  <target name="test1.odis">
    <antcall target="test.run" inheritAll="true">
      <param name="className" value="joram.studycase.odis.Test1" />
      <param name="jndiconf" value="studycase/odis/jndi.properties" />
      <param name="a3conf" value="studycase/odis/a3servers1.xml" />
      <param name="engine" value="fr.dyade.aaa.agent.Engine" />
      <param name="transaction" value="fr.dyade.aaa.util.NTransaction" />
      <param name="jvmargs" value="" />
    </antcall>
  </target>

</project>

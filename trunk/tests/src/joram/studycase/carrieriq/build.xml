<?xml version="1.0"?>

<!DOCTYPE project [
    <!ENTITY common SYSTEM "file:../../common.xml">
]>

<project default="tests" basedir="..">

  <!--
    - CarrierIQ Tests
    -->
  <target name="tests" depends="test.carrieriq"/>

  <target name="init.src">
    <!-- Tests specific sources set -->
    <patternset id="specific">
      <include name="joram/carrieriq/*.java"/>
    </patternset>
  </target>

  <!-- Include generic part -->
  &common;

  <target name="init.test.carrieriq" depends="init">
    <delete dir="${test.dir}"/>
    <mkdir dir="${test.dir}"/>
    <copy file="carrieriq/a3servers.xml" tofile="${test.dir}/a3servers.xml"/>
    <copy file="carrieriq/a3debug.cfg" tofile="${test.dir}/a3debug.cfg"/>
  </target>

  <target name="carrieriq.broker.run" depends="init.test.carrieriq">
    <java classname="joram.carrieriq.Broker"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line="-Dcom.sun.management.jmxremote -DMXServer=com.scalagent.jmx.JMXServer"/>
      <arg line=""/>
    </java>
  </target>

  <target name="carrieriq.producer.run" depends="init">
    <java classname="joram.carrieriq.Producer"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line=""/>
      <arg line=""/>
    </java>
  </target>

  <target name="carrieriq.consumer.run" depends="init">
    <java classname="joram.carrieriq.Consumer"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line=""/>
      <arg line=""/>
    </java>
  </target>

  <target name="carrieriq.converter.run" depends="init">
    <java classname="joram.carrieriq.Converter"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line=""/>
      <arg line=""/>
    </java>
  </target>

  <target name="carrieriq.ccons.run" depends="init">
    <java classname="joram.carrieriq.ConcurrentConsumer"
        failonerror="no" fork="yes" maxmemory="256m"
        dir="${test.dir}">
      <classpath path="${project.class.path}"/>
      <jvmarg line=""/>
      <arg line=""/>
    </java>
  </target>

</project>

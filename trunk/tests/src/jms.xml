<?xml version="1.0"?>

<!DOCTYPE project [
    <!ENTITY common SYSTEM "file:./common.xml">
]>

<project default="tests.jms.all" basedir=".">
  <!-- Includes generic stuff -->
  &common;

  <property file="env.properties" />

  <target name="init.src">
    <!-- Tests specific sources set -->
    <patternset id="specific">
      <include name="**/**/*.java" />
    </patternset>
  </target>

  <target name="tests.jms.all"
    description=" --> launch all jms tests">
    <ant dir="." antfile="jms.xml" target="tests.jms" />
  </target>

  <target name="tests.jms" description=" --> launch all jms tests">
    <ant dir="." antfile="jms.xml" target="jms.test" />
  </target>

  <target name="init.test.jms" depends="init">
    <delete dir="${test.dir}" />
    <mkdir dir="${test.dir}" />
    <copy file="a3config.dtd" todir="${test.dir}" />
    <copy file="jms/providers/admin/a3servers.xml"
      tofile="${test.dir}/a3servers.xml" />
    <copy file="jms/providers/admin/a3debug.cfg"
      tofile="${test.dir}/a3debug.cfg" />
    <copy file="jms/providers/admin/test.properties"
      tofile="${test.dir}/test.properties" />
    <copy file="jms/providers/admin/provider.properties"
      tofile="${test.dir}/provider.properties" />
  </target>

  <!-- jms test -->
  <target name="jms.test" depends="init.test.jms,compile"
    description=" --> test jms conformance.">
    <antcall target="test.jms.run" inheritAll="true">
      <param name="className" value="jms.main.Tests" />
    </antcall>
  </target>
  <!-- end jms test -->

  <target name="test.jms.run">
    <property name="a3debug" value="a3debug.cfg" />
    <!--  antcall target="init.test.joram" inheritAll="true" / -->
    <java classname="${className}" failonerror="no" fork="yes"
      maxmemory="256m" dir="${test.dir}">
      <classpath path="${project.class.path}" />
      <jvmarg
        line="-Dcom.sun.management.jmxremote -DMXServer=com.scalagent.jmx.JMXServer -Dframework.TestCase.TestId=0 -Dframework.TestCase.OutFile=${report.file} ${jvmargs}" />
      <!-- jvmarg line="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y"/ -->
      <arg line="${arg}" />
    </java>
  </target>

</project>